<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Unity Web Player | my first game</title>
    <link rel="shortcut icon" href="/TemplateData/favicon.ico" />
    <link rel="stylesheet" href="/TemplateData/style.css" />
    <link rel="icon" type="image/png" href="/img/webIcon.png" />
    <style>
      :root {
        --bg: #0f1720;
        --left-bg: #000000; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏î‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡∏≠‡∏ö‡∏ä‡∏±‡∏î */
        --right-bg: #1e1e2e;
        --gutter-bg: #252533;
        --gutter-color: #9aa0a6;
        --text: #d7d7d7;
        --muted: #9aa0a6;
        --accent: #3c7bd9;
        --editor-font: "Fira Code", "Consolas", "Courier New", monospace;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        font-family: system-ui, Segoe UI, Roboto, Arial;
        overflow: hidden; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Scrollbar ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å */
      }

      body {
        background: var(--bg);
        color: var(--text);
        display: flex; /* ‚úÖ ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏ö‡∏ö‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
        flex-direction: row; /* ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô ‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤ */
      }

      /* --- ‡∏™‡πà‡∏ß‡∏ô‡∏ã‡πâ‡∏≤‡∏¢: Unity Game --- */
      .left {
        flex: 0 0 50%; /* ‚úÖ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ñ‡∏á‡∏ó‡∏µ‡πà 50% ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô 60% ‡∏ï‡∏≤‡∏°‡∏ä‡∏≠‡∏ö */
        max-width: 50%; /* ‚úÖ ‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô */
        background: var(--left-bg);
        position: relative; /* ‚úÖ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Unity ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ */
        order: 1; /* ‡∏≠‡∏¢‡∏π‡πà‡∏ã‡πâ‡∏≤‡∏¢ */
        display: flex;
        justify-content: center;
        align-items: center;
      }

      /* --- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏ß‡∏≤: Editor --- */
      .right {
        flex: 1; /* ‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ */
        background: var(--right-bg);
        padding: 12px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        gap: 10px;
        min-width: 0; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Flex ‡πÅ‡∏ï‡∏Å */
        order: 2; /* ‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏ß‡∏≤ */
        height: 100%; /* ‡∏™‡∏π‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
      }

      /* --- üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Unity Container ‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å‡∏ô‡∏≠‡∏Å‡∏•‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏ó‡∏≤‡∏á --- */
      #unity-container {
        width: 100% !important; /* ‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á .left */
        height: 100% !important; /* ‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á .left */
        position: relative !important; /* ‚úÖ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å: ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å absolute ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á Unity */
        transform: none !important; /* ‚úÖ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ */
        left: auto !important;
        top: auto !important;
        display: flex !important;
        justify-content: center;
        align-items: center;
      }

      canvas {
        /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ Canvas ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏≤‡∏° container ‡πÅ‡∏ï‡πà‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∏‡∏°‡πÇ‡∏î‡∏¢ Unity JS */
        max-width: 100%;
        max-height: 100%;
        object-fit: contain; /* ‡πÉ‡∏´‡πâ‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏û‡∏≠‡∏î‡∏µ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô */
      }

      /* ‡∏ã‡πà‡∏≠‡∏ô Loading Bar ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à (optional) */
      #unity-loading-bar {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      /* --- CSS ‡∏Ç‡∏≠‡∏á Editor (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) --- */
      .controls {
        display: flex;
        gap: 10px;
        align-items: flex-start;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          transparent
        );
        padding: 10px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.03);
        flex-shrink: 0; /* ‡∏´‡πâ‡∏≤‡∏°‡∏´‡∏î */
      }

      .controls .col {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      label {
        font-size: 12px;
        color: var(--muted);
      }

      select,
      textarea.input-problem {
        background: transparent;
        color: var(--text);
        border: 1px solid rgba(255, 255, 255, 0.04);
        padding: 8px;
        border-radius: 6px;
        min-width: 100px; /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏•‡∏á‡∏´‡∏ô‡πà‡∏≠‡∏¢ */
        outline: none;
      }

      textarea.input-problem {
        min-height: 40px;
        resize: vertical;
        width: 100%;
        font-family: inherit;
        font-size: 13px;
      }

      .editor-wrap {
        flex: 1; /* ‡πÉ‡∏´‡πâ Editor ‡∏¢‡∏∑‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ */
        display: flex;
        overflow: hidden;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.03);
      }

      .gutter {
        width: 40px;
        background: var(--gutter-bg);
        color: var(--gutter-color);
        padding: 8px 4px;
        text-align: right;
        font-family: var(--editor-font);
        font-size: 13px;
        line-height: 20px;
        overflow: hidden;
      }

      .editor {
        flex: 1;
        position: relative;
        background: transparent;
        overflow: hidden;
      }

      #code {
        width: 100%;
        height: 100%;
        resize: none;
        border: 0;
        outline: none;
        background: transparent;
        color: var(--text);
        font-family: var(--editor-font);
        font-size: 13px;
        line-height: 20px;
        padding: 8px 12px;
        box-sizing: border-box;
        white-space: pre;
        overflow: auto;
      }

      .command {
        background: #2c2c3c;
        padding: 6px 10px;
        font-size: 13px;
        color: var(--muted);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
      }

      button {
        border-radius: 7px;
        padding: 4px 10px;
        cursor: pointer;
      }

      #output {
        background: #0d0d0d;
        color: #0f0;
        padding: 10px;
        height: 120px;
        overflow: auto;
        white-space: pre;
        border-radius: 6px;
        border: 1px solid #333;
        font-size: 13px;
        margin-top: 8px;
        flex-shrink: 0;
      }
      .gutter {
        width: 56px;
        background: var(--gutter-bg);
        color: var(--gutter-color);
        padding: 8px 6px;
        box-sizing: border-box;
        font-family: var(--editor-font);
        font-size: 13px;
        line-height: 20px;
        text-align: right;
        overflow: hidden;
      }

      .gutter .lines {
        user-select: none;
        display: block;
        white-space: pre;
      }
      @media (max-width: 800px) {
        body {
          flex-direction: column;
        }
        .left {
          flex: 0 0 40vh;
          width: 100%;
          max-width: 100%;
          order: 1;
        }
        .right {
          width: 100%;
          order: 2;
        }
      }
    </style>
  </head>
  <body>
    <!-- Game -->
    <div id="unity-container" class="unity-desktop panel left">
      <canvas id="unity-canvas" width="960" height="600" tabindex="-1"></canvas>
      <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty">
          <div id="unity-progress-bar-full"></div>
        </div>
      </div>
      <div id="unity-warning"></div>
      <!-- <div id="unity-footer">
        <div id="unity-logo-title-footer"></div>
        <div id="unity-fullscreen-button"></div>
        <div id="unity-build-title">my first game</div>
      </div> -->
    </div>

    <!-- button summon Editor -->
    <!-- <div class="editor">
      <button onclick="" style="padding: 20px; border-radius: 20%; border-width: 0.4rem;">
        Editor
      </button>
    </div> -->

    <!-- Editor!!! -->
    <div class="panel right">
      <div class="controls">
        <div class="col">
          <label for="lang">‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</label>
          <select id="lang">
            <option value="62" style="color: #000000">Java</option>
            <option value="63" style="color: #000000">JavaScript</option>
            <option value="71" style="color: #000000">Python</option>
            <option value="54" style="color: #000000">C++</option>
          </select>
        </div>
        <div class="col">
          <label for="difficulty">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å-‡∏á‡πà‡∏≤‡∏¢</label>
          <select id="difficulty">
            <option value="easy" style="color: #000000">‡∏á‡πà‡∏≤‡∏¢</option>
            <option value="mid" style="color: #000000">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
            <option value="hard" style="color: #000000">‡∏¢‡∏≤‡∏Å</option>
          </select>
        </div>
        <div class="col" style="flex: 1; max-width: 600px">
          <label for="problem">‡πÇ‡∏à‡∏ó‡∏¢‡πå</label>
          <textarea
            id="problem"
            class="input-problem"
            placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."
          >
‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏∏‡πà‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå</textarea
          >
        </div>
        <div class="col" style="display: inline-block; margin-top: 20px">
          <label>&nbsp;</label>
          <button id="randomQuestBtn">‡∏™‡∏∏‡πà‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå</button>
          <button onclick="back()">‡∏≠‡∏≠‡∏Å</button>
        </div>
      </div>

      <div class="command">
        Coding here...
        <div>
          <button id="runBtn">Run</button>
          <button id="submitBtn">Submit</button>
        </div>
      </div>

      <div
        class="editor-wrap"
        id="editorWrap"
        style="height: calc(100% - 200px)"
      >
        <div class="gutter" id="gutter">
          <div class="lines" id="lineNumbers">1</div>
        </div>
        <div class="editor">
          <textarea
            id="code"
            spellcheck="false"
            autocomplete="off"
            autocorrect="off"
            autocapitalize="off"
          >
// ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
import java.util.Scanner;
public class Main {
    public static void main(String[] args) {
        Scanner input = new Scanner(System.in);
        int n = input.nextInt();
        for(int i = 1 ; i <= 12 ; i++){
            System.out.println(n+" x "+i+" = "+n*i);
        }
    }
}</textarea
          >
        </div>
      </div>

      <div id="output">Output ‡∏à‡∏∞‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...</div>
    </div>
    <script>
      var canvas = document.querySelector("#unity-canvas");

      // Shows a temporary message banner/ribbon for a few seconds, or
      // a permanent error message on top of the canvas if type=='error'.
      // If type=='warning', a yellow highlight color is used.
      // Modify or remove this function to customize the visually presented
      // way that non-critical warnings and error messages are presented to the
      // user.
      function unityShowBanner(msg, type) {
        var warningBanner = document.querySelector("#unity-warning");
        function updateBannerVisibility() {
          warningBanner.style.display = warningBanner.children.length
            ? "block"
            : "none";
        }
        var div = document.createElement("div");
        div.innerHTML = msg;
        warningBanner.appendChild(div);
        if (type == "error") div.style = "background: red; padding: 10px;";
        else {
          if (type == "warning")
            div.style = "background: yellow; padding: 10px;";
          setTimeout(function () {
            warningBanner.removeChild(div);
            updateBannerVisibility();
          }, 5000);
        }
        updateBannerVisibility();
      }

      var buildUrl = "/Build";
      var loaderUrl = buildUrl + "/Game-WebGL-Game-Camera+Nametext.loader.js";
      var config = {
        arguments: [],
        dataUrl: buildUrl + "/Game-WebGL-Game-Camera+Nametext.data",
        frameworkUrl:
          buildUrl + "/Game-WebGL-Game-Camera+Nametext.framework.js",
        codeUrl: buildUrl + "/Game-WebGL-Game-Camera+Nametext.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "my first game",
        productVersion: "1.0",
        showBanner: unityShowBanner,
      };

      // By default, Unity keeps WebGL canvas render target size matched with
      // the DOM size of the canvas element (scaled by window.devicePixelRatio)
      // Set this to false if you want to decouple this synchronization from
      // happening inside the engine, and you would instead like to size up
      // the canvas DOM size and WebGL render target sizes yourself.
      // config.matchWebGLToCanvasSize = false;

      // If you would like all file writes inside Unity Application.persistentDataPath
      // directory to automatically persist so that the contents are remembered when
      // the user revisits the site the next time, uncomment the following line:
      // config.autoSyncPersistentDataPath = true;
      // This autosyncing is currently not the default behavior to avoid regressing
      // existing user projects that might rely on the earlier manual
      // JS_FileSystem_Sync() behavior, but in future Unity version, this will be
      // expected to change.

      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        // Mobile device style: fill the whole browser client area with the game canvas:

        var meta = document.createElement("meta");
        meta.name = "viewport";
        meta.content =
          "width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes";
        document.getElementsByTagName("head")[0].appendChild(meta);
        document.querySelector("#unity-container").className = "unity-mobile";
        canvas.className = "unity-mobile";

        // To lower canvas resolution on mobile devices to gain some
        // performance, uncomment the following line:
        // config.devicePixelRatio = 1;
      } else {
        // Desktop style: Render the game canvas in a window that can be maximized to fullscreen:
        canvas.style.width = "960px";
        canvas.style.height = "600px";
      }

      document.querySelector("#unity-loading-bar").style.display = "block";

      var script = document.createElement("script");
      script.src = loaderUrl;
      script.onload = () => {
        createUnityInstance(canvas, config, (progress) => {
          document.querySelector("#unity-progress-bar-full").style.width =
            100 * progress + "%";
        })
          .then((unityInstance) => {
            document.querySelector("#unity-loading-bar").style.display = "none";
            // document.querySelector("#unity-fullscreen-button").onclick = () => {
            //   unityInstance.SetFullscreen(1);
            // };

            // Unloading web content from DOM so that browser GC can run can be tricky to get right.
            // This code snippet shows how to correctly implement a Unity content Unload mechanism to a web page.

            // Unloading Unity content enables a web page to reclaim the memory used by Unity, e.g. for
            // the purpose of later loading another Unity content instance on the _same_ web page.

            // When using this functionality, take caution to carefully make sure to clear all JavaScript code,
            // DOM element and event handler references to the old content you may have retained, or
            // otherwise the browser's garbage collector will be unable to reclaim the old page.

            // N.b. Unity content does _not_ need to be manually unloaded when the user is navigating away from
            // the current page to another web page. The browser will take care to clear memory of old visited
            // pages automatically. This functionality is only needed if you want to switch between loading
            // multiple Unity builds on a single web page.
            var quit = document.createElement("button");
            quit.style =
              "margin-left: 5px; background-color: lightgray; border: none; padding: 5px; cursor: pointer";
            quit.innerHTML = "Unload";
            // document.querySelector("#unity-build-title").appendChild(quit);
            // quit.onclick = () => {
            //   // Quit Unity application execution
            //   unityInstance.Quit().then(() => {
            //     // Remove DOM elements from the page so GC can run
            //     document.querySelector("#unity-container").remove();
            //     canvas = null;
            //     // Remover script elements from the page so GC can run
            //     script.remove();
            //     script = null;
            //   });
            // };
          })
          .catch((message) => {
            alert(message);
          });
      };
      document.body.appendChild(script);

      ["keydown", "keypress", "keyup"].forEach((evt) => {
        window.addEventListener(
          evt,
          function (e) {
            const active = document.activeElement;
            if (
              active &&
              (active.tagName === "TEXTAREA" ||
                active.tagName === "INPUT" ||
                active.tagName === "SELECT")
            ) {
              e.stopImmediatePropagation(); // ‡∏Å‡∏±‡∏ô Unity ‡πÅ‡∏¢‡πà‡∏á‡∏Ñ‡∏µ‡∏¢‡πå
            }
          },
          true
        ); // capture phase
      });
      // ------- Judge0 -------
      (function () {
        const code = document.getElementById("code");
        const lineNumbers = document.getElementById("lineNumbers");
        const gutter = document.getElementById("gutter");

        function updateLineNumbers() {
          const lines = code.value.split("\n").length;
          let nums = "";
          for (let i = 1; i <= lines; i++) nums += i + "\n";
          lineNumbers.textContent = nums;
        }

        code.addEventListener("scroll", () => {
          gutter.scrollTop = code.scrollTop;
        });
        code.addEventListener("input", updateLineNumbers);
        code.addEventListener("keydown", function (e) {
          if (e.key === "Tab") {
            e.preventDefault();
            let s = this.selectionStart;
            let ePos = this.selectionEnd;
            this.value =
              this.value.substring(0, s) + "\t" + this.value.substring(ePos);
            this.selectionStart = this.selectionEnd = s + 1;
            updateLineNumbers();
          }
        });

        updateLineNumbers();
      })();

      // -------- Judge0 --------
      const runBtn = document.getElementById("runBtn");
      const output = document.getElementById("output");
      let timeout = null;
      runBtn.addEventListener("click", async () => {
        clearInterval(timeout);
        let dots = 0;
        timeout = setInterval(() => {
          dots = (dots % 3) + 1;
          output.textContent = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î" + ".".repeat(dots);
        }, 500);

        const lang = document.getElementById("lang").value;
        const code = document.getElementById("code").value;

        try {
          let res = await fetch(
            "https://ce.judge0.com/submissions/?base64_encoded=false&wait=true",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                source_code: code,
                language_id: lang,
                stdin: currentQuest ? currentQuest.inputRun : "2",
              }),
            }
          );
          let result = await res.json();
          clearInterval(timeout);
          if (result.stdout) {
            output.textContent =
              result.stdout +
              "\n‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: " +
              result.time +
              " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ" +
              "\nmomory ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: " +
              result.memory +
              "KB";
          } else if (result.stderr)
            output.textContent = "Error:\n" + result.stderr;
          else if (result.compile_output)
            output.textContent = "Compile Error:\n" + result.compile_output;
          else output.textContent = "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö output";
        } catch (err) {
          clearInterval(timeout);
          output.textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message;
        }
      });
      function normalize(str) {
        return str.replace(/\r\n/g, "\n").trim();
      }
      //‡∏™‡πà‡∏á Submit ‡πÄ‡∏Ç‡πâ‡∏≤ Unity
      const submitBtn = document.getElementById("submitBtn");
      let submitTimeout = null;
      document
        .getElementById("submitBtn")
        .addEventListener("click", async () => {
          if (!currentQuest) {
            output.textContent = "‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏∏‡πà‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Å‡πà‡∏≠‡∏ô";
            return;
          }

          clearInterval(submitTimeout);
          let dots = 0;
          submitTimeout = setInterval(() => {
            dots = (dots % 3) + 1;
            output.textContent =
              "‡∏™‡πà‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ! \r‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î" + ".".repeat(dots);
          }, 500);

          const lang = document.getElementById("lang").value;
          const code = document.getElementById("code").value;

          try {
            let res = await fetch(
              "https://ce.judge0.com/submissions/?base64_encoded=false&wait=true",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  source_code: code,
                  language_id: lang,
                  stdin: currentQuest.inputSubmit, // ‚úÖ ‡πÉ‡∏ä‡πâ inputSubmit ‡∏à‡∏≤‡∏Å‡πÇ‡∏à‡∏ó‡∏¢‡πå
                }),
              }
            );

            let result = await res.json();
            clearInterval(submitTimeout);

            if (result.stdout) {
              if (
                normalize(result.stdout) ===
                normalize(currentQuest.expectedOutput)
              ) {
                // ‚úÖ ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö expectedOutput
                output.textContent =
                  "‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!! ‚úÖ" +
                  "\n‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: " +
                  result.time +
                  " ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ" +
                  "\nmemory ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: " +
                  result.memory +
                  "KB" +
                  "\n‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•: "+currentQuest.rewards;
                  addReward(currentQuest.rewards)
                // if (unityInstance) {
                //   unityInstance.SendMessage("player", "OnSubmitClicked");
                // }
              } else {
                output.textContent =
                  "‚ùå Output ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£\n" +
                  "Expected:\n" +
                  currentQuest.expectedOutput +
                  "\n" +
                  "Got:\n" +
                  result.stdout;
              }
            } else if (result.stderr) {
              output.textContent = "Error:\n" + result.stderr;
            } else if (result.compile_output) {
              output.textContent = "Compile Error:\n" + result.compile_output;
            } else {
              output.textContent = "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö output";
            }
          } catch (err) {
            clearInterval(submitTimeout);
            output.textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message;
          }
        });

      let currentQuest = null; // ‡πÄ‡∏Å‡πá‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏™‡∏∏‡πà‡∏°‡∏°‡∏≤

      document
        .getElementById("randomQuestBtn")
        .addEventListener("click", async () => {
          try {
            // 1. ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏à‡∏≤‡∏Å Dropdown ‡∏°‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏™‡πà‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Å‡πà‡∏≠‡∏ô
            const difficultyLevel = document.getElementById("difficulty").value;

            // 2. ‡πÅ‡∏Å‡πâ URL ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Backticks (`) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏•‡∏á‡πÑ‡∏õ‡πÑ‡∏î‡πâ
            let res = await fetch(`/api/quests/random/${difficultyLevel}`);

            if (!res.ok) {
              throw new Error(`Server error: ${res.status}`);
            }

            let quest = await res.json();
            currentQuest = quest;

            // 3. (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç) ‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ Key ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏° Run/Submit ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ
            // ‡πÉ‡∏ô Database ‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô snake_case (input_run) ‡πÅ‡∏ï‡πà‡∏õ‡∏∏‡πà‡∏° Submit ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å inputRun
            currentQuest.inputRun = quest.input_run;
            currentQuest.inputSubmit = quest.input_submit;
            currentQuest.expectedOutput = quest.expected_output;
            currentQuest.rewards = quest.rewards

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô UI
            document.getElementById("problem").value = quest.description;
            output.textContent = "‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏î‡πâ‡πÇ‡∏à‡∏ó‡∏¢‡πå: " + quest.title + "\n";
            output.textContent += "Input ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: " + quest.input_run + "\n";
            output.textContent +=
              "‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:\n" + quest.show_expect_output;
          } catch (err) {
            console.error(err); // ‡∏î‡∏π error ‡πÉ‡∏ô console
            output.textContent = "‡∏™‡∏∏‡πà‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + err.message;
          }
        });
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ö‡∏ß‡∏Å‡πÄ‡∏á‡∏¥‡∏ô
      async function addReward(amount) {
        try {
          const res = await fetch("/api/user/add-coins", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ amount: amount }),
          });

          if (!res.ok) {
            const err = await res.json();
            console.error("‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤:", err);
            return;
          }

          const data = await res.json();
          console.log("‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•! ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠:", data.newBalance);

          // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Unity ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏õ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡πÉ‡∏ô‡πÄ‡∏Å‡∏°
          if (unityInstance) {
            // unityInstance.SendMessage("GameManager", "UpdateCoins", data.newBalance);
          }
        } catch (err) {
          console.error("Server Error:", err);
        }
      }
      function back() {
        window.location.href = "/";
      }
    </script>
  </body>
</html>
